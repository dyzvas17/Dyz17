<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shivam & Naqii | Forever Haven</title>
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&family=Outfit:wght@300;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --accent: #ff4d6d; --text: #ffffff;
            --glass: rgba(15, 23, 42, 0.75);
            --border: rgba(255, 255, 255, 0.2);
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        
        body, html {
            margin: 0; padding: 0; width: 100%; height: 100%;
            font-family: 'Outfit', sans-serif; color: var(--text);
            overflow: hidden; display: flex; justify-content: center; align-items: center;
            background: #000;
        }

        /* --- ANIME BACKGROUND --- */
        .video-bg {
            position: fixed; inset: 0; width: 100%; height: 100%;
            object-fit: cover; z-index: -1;
            filter: brightness(0.6) contrast(1.1);
            background: url('https://i.pinimg.com/originals/f3/04/70/f30470eb0bcda030636259f93310069e.gif') no-repeat center center/cover;
        }

        .app-container {
            width: 90%; max-width: 410px; height: 90vh;
            background: var(--glass); backdrop-filter: blur(25px); -webkit-backdrop-filter: blur(25px);
            border: 1.5px solid var(--border); border-radius: 40px;
            box-shadow: 0 25px 50px rgba(0,0,0,0.8);
            position: relative; overflow: hidden;
        }

        .screen {
            position: absolute; inset: 0; padding: 30px;
            display: flex; flex-direction: column; align-items: center;
            opacity: 0; pointer-events: none; transform: scale(1.1);
            transition: all 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
            overflow-y: auto; padding-bottom: 110px;
        }
        .screen.active { opacity: 1; pointer-events: all; transform: scale(1); }

        .script-font { font-family: 'Dancing Script', cursive; text-shadow: 0 0 15px var(--accent); }

        /* --- MEMORY STYLES --- */
        .memories-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; width: 100%; }
        .memory-item {
            width: 100%; height: 140px; border-radius: 20px; border: 2px solid #fff;
            object-fit: cover; cursor: pointer; transition: 0.3s;
            animation: popIn 0.5s ease forwards;
        }
        @keyframes popIn { from { opacity: 0; transform: scale(0.8); } to { opacity: 1; transform: scale(1); } }

        .add-btn {
            width: 100%; height: 140px; border-radius: 20px; border: 2px dashed var(--border);
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            background: rgba(255,255,255,0.05); cursor: pointer; color: var(--accent);
        }

        /* --- UI TILES --- */
        .tile-btn {
            background: rgba(255,255,255,0.1); border-radius: 25px;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            border: 1px solid var(--border); transition: 0.3s; cursor: pointer;
            aspect-ratio: 1; background-size: cover; background-position: center;
        }
        .tile-btn:active { transform: scale(0.92); }

        .relationship-counter {
            background: linear-gradient(135deg, var(--accent), #7000ff);
            width: 100%; padding: 20px; border-radius: 25px; margin: 20px 0;
            text-align: center; box-shadow: 0 10px 30px rgba(255,77,109,0.4);
        }

        #drawCanvas { background: rgba(255, 255, 255, 0.05); border-radius: 25px; touch-action: none; border: 2px solid var(--border); }

        .music-bar {
            position: absolute; bottom: 25px; left: 50%; transform: translateX(-50%);
            width: 85%; background: rgba(0,0,0,0.7); backdrop-filter: blur(15px);
            border-radius: 50px; padding: 12px 25px; display: flex; align-items: center;
            border: 1px solid var(--border); z-index: 100;
        }
        .vinyl { width: 40px; height: 40px; background: #222; border-radius: 50%; border: 2px solid var(--accent); animation: spin 4s linear infinite paused; }
        .vinyl.playing { animation-play-state: running; }
        @keyframes spin { 100% { transform: rotate(360deg); } }

        /* Fullscreen Overlay */
        #overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.95); display: none; place-items: center; z-index: 2000; }
        #overlay img { max-width: 95%; max-height: 85%; border-radius: 15px; border: 2px solid white; }
    </style>
</head>
<body>

    <div class="video-bg"></div>

    <div class="app-container">
        
        <div id="screen-lock" class="screen active" style="justify-content: center;">
            <h1 class="script-font" style="font-size: 45px;">Haven</h1>
            <input type="password" id="pass" style="background:rgba(255,255,255,0.1); border:1.5px solid var(--border); padding:15px; border-radius:15px; color:white; text-align:center; outline:none;" placeholder="Secret Code">
            <button class="tile-btn" style="width: 70px; height: 70px; border-radius: 50%; margin-top: 30px;" onclick="unlock()">‚ûî</button>
        </div>

        <div id="screen-home" class="screen">
            <h2 class="script-font" style="font-size: 35px; width: 100%;">Hi Love ‚ù§Ô∏è</h2>
            
            <div class="relationship-counter">
                <h3 id="days" style="font-size: 42px; margin: 0;">0</h3>
                <p style="margin: 0; font-size: 12px; letter-spacing: 2px;">DAYS TOGETHER</p>
            </div>

            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; width: 100%;">
                <div class="tile-btn" onclick="nav('screen-letters')"><span>üíå</span><br>Letters</div>
                <div class="tile-btn" onclick="nav('screen-gallery')"><span>üì∏</span><br>Gallery</div>
                <div class="tile-btn" onclick="nav('screen-timeline')"><span>‚è≥</span><br>Journey</div>
                <div class="tile-btn" id="doodle-tile" onclick="nav('screen-canvas')">
                    <span id="d-icon">üé®</span><br><span id="d-text">Doodle</span>
                </div>
            </div>
        </div>

        <div id="screen-gallery" class="screen">
            <button style="align-self: flex-start; background: none; border: none; color: white; font-size: 28px;" onclick="nav('screen-home')">‚Üê</button>
            <h2 class="script-font" style="font-size: 32px;">Memories</h2>
            <br>
            <div class="memories-grid" id="memories-container">
                <label class="add-btn">
                    <input type="file" accept="image/*" style="display:none" onchange="uploadImage(this)">
                    <span style="font-size: 30px;">+</span>
                    <small>Add Memory</small>
                </label>
                <img src="memory1.jpg" class="memory-item" onclick="view(this.src)">
                <img src="memory2.jpg" class="memory-item" onclick="view(this.src)">
                <img src="memory3.jpg" class="memory-item" onclick="view(this.src)">
                <img src="memory4.jpg" class="memory-item" onclick="view(this.src)">
            </div>
        </div>

        <div id="screen-canvas" class="screen">
            <button style="align-self: flex-start; background: none; border: none; color: white; font-size: 28px;" onclick="nav('screen-home')">‚Üê</button>
            <h2 class="script-font">Doodle</h2><br>
            <canvas id="drawCanvas" width="320" height="350"></canvas>
            <div style="display: flex; gap: 15px; margin-top: 20px;">
                <div style="width: 40px; height: 40px; border-radius: 50%; background: #ff4d6d; border: 2px solid white;" onclick="setPen('#ff4d6d')"></div>
                <div style="width: 40px; height: 40px; border-radius: 50%; background: #3b82f6; border: 2px solid white;" onclick="setPen('#3b82f6')"></div>
                <button onclick="clearC()" style="background: none; border: 1px solid white; color: white; padding: 0 20px; border-radius: 12px;">Clear</button>
            </div>
        </div>

        <div id="m-bar" class="music-bar" style="display: none;">
            <div class="vinyl" id="vinyl"></div>
            <div style="flex: 1; margin-left: 15px;">
                <b style="font-size: 14px;">Our Special Song</b><br>
                <small id="m-status" style="opacity: 0.6;">Tap to Play</small>
            </div>
            <button onclick="toggleM()" style="background: none; border: none; color: white; font-size: 24px;">‚èØÔ∏è</button>
        </div>

    </div>

    <div id="overlay" onclick="this.style.display='none'"><img id="o-img"></div>
    <audio id="music" loop><source src="us.mp3"></audio>

    <script>
        const START = new Date("2023-12-31"); 
        const audio = document.getElementById('music');
        const canvas = document.getElementById('drawCanvas');
        const ctx = canvas.getContext('2d');
        let painting = false;

        // --- DATABASE LOGIC (INDEXEDDB) ---
        let db;
        const request = indexedDB.open("MemoriesDB", 1);
        request.onupgradeneeded = e => {
            db = e.target.result;
            db.createObjectStore("photos", { autoIncrement: true });
        };
        request.onsuccess = e => {
            db = e.target.result;
            loadStoredImages();
        };

        function nav(id) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            if(id !== 'screen-lock') document.getElementById('m-bar').style.display = 'flex';
        }

        function unlock() {
            if(document.getElementById('pass').value === "1234") { nav('screen-home'); updateDoodle(); }
        }

        // --- UPLOAD LOGIC ---
        function uploadImage(input) {
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = e => {
                    const base64 = e.target.result;
                    const transaction = db.transaction(["photos"], "readwrite");
                    transaction.objectStore("photos").add(base64);
                    transaction.oncomplete = () => {
                        displayImage(base64);
                    };
                };
                reader.readAsDataURL(input.files[0]);
            }
        }

        function loadStoredImages() {
            const transaction = db.transaction(["photos"], "readonly");
            transaction.objectStore("photos").openCursor().onsuccess = e => {
                const cursor = e.target.result;
                if (cursor) {
                    displayImage(cursor.value);
                    cursor.continue();
                }
            };
        }

        function displayImage(src) {
            const img = document.createElement('img');
            img.src = src;
            img.className = 'memory-item';
            img.onclick = () => view(src);
            document.getElementById('memories-container').appendChild(img);
        }

        // --- DRAWING LOGIC ---
        function getPos(e) {
            const r = canvas.getBoundingClientRect();
            return { x: (e.clientX || e.touches[0].clientX) - r.left, y: (e.clientY || e.touches[0].clientY) - r.top };
        }
        canvas.onmousedown = (e) => { painting = true; ctx.beginPath(); const p = getPos(e); ctx.moveTo(p.x, p.y); };
        canvas.onmousemove = (e) => { if(!painting) return; const p = getPos(e); ctx.lineWidth = 4; ctx.lineCap = 'round'; ctx.lineTo(p.x, p.y); ctx.stroke(); };
        window.onmouseup = () => { painting = false; localStorage.setItem('drawn', canvas.toDataURL()); updateDoodle(); };
        
        // Touch support
        canvas.ontouchstart = (e) => { painting = true; ctx.beginPath(); const p = getPos(e.touches[0]); ctx.moveTo(p.x, p.y); e.preventDefault(); };
        canvas.ontouchmove = (e) => { if(!painting) return; const p = getPos(e.touches[0]); ctx.lineTo(p.x, p.y); ctx.stroke(); e.preventDefault(); };
        canvas.ontouchend = () => { painting = false; localStorage.setItem('drawn', canvas.toDataURL()); updateDoodle(); };

        function setPen(c) { ctx.strokeStyle = c; }
        function clearC() { ctx.clearRect(0,0,320,350); localStorage.removeItem('drawn'); updateDoodle(); }

        function updateDoodle() {
            const img = localStorage.getItem('drawn');
            const tile = document.getElementById('doodle-tile');
            if(img) {
                tile.style.backgroundImage = `url(${img})`;
                document.getElementById('d-icon').style.display = 'none';
                document.getElementById('d-text').style.background = 'rgba(0,0,0,0.5)';
            }
        }

        function toggleM() {
            if(audio.paused) { audio.play(); document.getElementById('vinyl').classList.add('playing'); document.getElementById('m-status').innerText = 'Playing'; }
            else { audio.pause(); document.getElementById('vinyl').classList.remove('playing'); document.getElementById('m-status').innerText = 'Paused'; }
        }

        function view(s) { document.getElementById('o-img').src = s; document.getElementById('overlay').style.display = 'grid'; }

        document.getElementById('days').innerText = Math.floor((new Date() - START)/(1000*60*60*24));
    
</script>
</body>
</html>
